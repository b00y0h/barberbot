---
phase: 01-infrastructure-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/env.ts
  - src/services/aws-clients.ts
  - .env.example
  - package.json
  - pnpm-lock.yaml
autonomous: true
user_setup:
  - service: aws
    why: "AWS IAM credentials for Bedrock, Transcribe, and Polly access"
    env_vars:
      - name: AWS_ACCESS_KEY_ID
        source: "AWS IAM Console -> Users -> Security credentials -> Create access key"
      - name: AWS_SECRET_ACCESS_KEY
        source: "AWS IAM Console -> Users -> Security credentials -> Create access key"
      - name: AWS_REGION
        source: "Set to us-east-2 or us-west-2 (Bedrock latency-optimized regions)"
    dashboard_config:
      - task: "Ensure IAM user has permissions for bedrock:InvokeModel, transcribe:StartStreamTranscription, polly:SynthesizeSpeech"
        location: "AWS IAM Console -> Users -> Permissions"
      - task: "Enable Claude 3.5 Sonnet model access in Bedrock"
        location: "AWS Bedrock Console -> Model access -> Request access for Anthropic Claude 3.5 Sonnet"

must_haves:
  truths:
    - "AWS credentials load from environment variables without errors"
    - "Bedrock, Transcribe, and Polly SDK clients instantiate successfully"
    - "AWS region is configured for Bedrock latency-optimized inference"
    - "TypeScript compiles without errors after changes"
  artifacts:
    - path: "src/config/env.ts"
      provides: "AWS environment variable configuration"
      contains: "aws"
    - path: "src/services/aws-clients.ts"
      provides: "Factory functions for Bedrock, Transcribe, and Polly clients"
      exports: ["getBedrockClient", "getTranscribeClient", "getPollyClient"]
    - path: ".env.example"
      provides: "AWS env var documentation"
      contains: "AWS_ACCESS_KEY_ID"
  key_links:
    - from: "src/services/aws-clients.ts"
      to: "src/config/env.ts"
      via: "imports env.aws config"
      pattern: "import.*env.*from.*config/env"
---

<objective>
Configure AWS SDK clients for Bedrock, Transcribe Streaming, and Polly with IAM credential authentication.

Purpose: Establish the AWS infrastructure layer that all subsequent migration phases depend on. Without working, authenticated SDK clients, no service migration can proceed.

Output: AWS env config in env.ts, client factory in aws-clients.ts, updated .env.example, AWS SDK packages installed.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/config/env.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install AWS SDK packages and add AWS config to env.ts</name>
  <files>package.json, pnpm-lock.yaml, src/config/env.ts, .env.example</files>
  <action>
Install AWS SDK v3 packages (modular):
- @aws-sdk/client-bedrock-runtime (for Bedrock Claude invoke)
- @aws-sdk/client-transcribe-streaming (for real-time STT)
- @aws-sdk/client-polly (for TTS)

Add `aws` section to the `EnvConfig` interface in `src/config/env.ts`:
```typescript
aws: {
  accessKeyId: string;
  secretAccessKey: string;
  region: string;
};
```

Add to the `env` object:
```typescript
aws: {
  accessKeyId: required('AWS_ACCESS_KEY_ID'),
  secretAccessKey: required('AWS_SECRET_ACCESS_KEY'),
  region: process.env.AWS_REGION || 'us-east-2',
},
```

Default region is `us-east-2` (Bedrock latency-optimized). User can override via AWS_REGION env var.

Update `.env.example` to add AWS section after the OpenAI section:
```
# AWS (Bedrock, Transcribe, Polly)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-2
```
  </action>
  <verify>
Run `pnpm install` completes without errors.
Run `pnpm build` compiles without TypeScript errors.
Confirm .env.example contains AWS variables.
  </verify>
  <done>AWS SDK packages installed, env.ts has aws config section, .env.example documents AWS vars, project compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Create AWS client factory module</name>
  <files>src/services/aws-clients.ts</files>
  <action>
Create `src/services/aws-clients.ts` that exports factory functions for all three AWS service clients.

Pattern: Follow the existing codebase style (lazy singletons, similar to how Twilio client is created in `src/services/twilio.ts`).

Implementation:
1. Import the three AWS SDK client classes:
   - `BedrockRuntimeClient` from `@aws-sdk/client-bedrock-runtime`
   - `TranscribeStreamingClient` from `@aws-sdk/client-transcribe-streaming`
   - `PollyClient` from `@aws-sdk/client-polly`

2. Import `env` from `../config/env`

3. Create a shared credentials config factory:
```typescript
function getAwsConfig() {
  return {
    region: env.aws.region,
    credentials: {
      accessKeyId: env.aws.accessKeyId,
      secretAccessKey: env.aws.secretAccessKey,
    },
  };
}
```

4. Create lazy singleton getters for each client:
```typescript
let bedrockClient: BedrockRuntimeClient | null = null;
let transcribeClient: TranscribeStreamingClient | null = null;
let pollyClient: PollyClient | null = null;

export function getBedrockClient(): BedrockRuntimeClient {
  if (!bedrockClient) {
    bedrockClient = new BedrockRuntimeClient(getAwsConfig());
    console.log(`[AWS] Bedrock client initialized (region: ${env.aws.region})`);
  }
  return bedrockClient;
}

export function getTranscribeClient(): TranscribeStreamingClient {
  if (!transcribeClient) {
    transcribeClient = new TranscribeStreamingClient(getAwsConfig());
    console.log(`[AWS] Transcribe client initialized (region: ${env.aws.region})`);
  }
  return transcribeClient;
}

export function getPollyClient(): PollyClient {
  if (!pollyClient) {
    pollyClient = new PollyClient(getAwsConfig());
    console.log(`[AWS] Polly client initialized (region: ${env.aws.region})`);
  }
  return pollyClient;
}
```

Use `[AWS]` log prefix to match codebase convention (e.g., `[CallManager]`, `[STT]`).
  </action>
  <verify>
Run `pnpm build` compiles without TypeScript errors.
Verify the file exports all three getter functions: `grep -n "export function" src/services/aws-clients.ts`
  </verify>
  <done>aws-clients.ts exports getBedrockClient, getTranscribeClient, getPollyClient as lazy singletons using IAM credentials from env config. Project compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `pnpm build` succeeds with zero errors
2. `src/services/aws-clients.ts` exists and exports three client getters
3. `src/config/env.ts` includes aws section with accessKeyId, secretAccessKey, region
4. `.env.example` documents all three AWS env vars
5. `package.json` includes @aws-sdk/client-bedrock-runtime, @aws-sdk/client-transcribe-streaming, @aws-sdk/client-polly
</verification>

<success_criteria>
- AWS SDK v3 packages installed and importable
- env.ts loads AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION from environment
- aws-clients.ts provides lazy singleton clients for Bedrock, Transcribe, Polly
- All clients use same IAM credentials and region config
- TypeScript compilation succeeds
- No existing functionality broken
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-setup/01-01-SUMMARY.md`
</output>
