# v1.0 Requirements Archive: BarberBot AWS Migration

**Milestone:** v1.0
**Defined:** 2026-01-27
**Completed:** 2026-01-30
**Core Value:** Callers can have a natural phone conversation with the bot and book an appointment without human intervention.

## Requirements Summary

- **Total:** 23 requirements
- **Satisfied:** 23 (100%)
- **Adjusted:** 0
- **Dropped:** 0

## v1 Requirements (All Complete)

### Infrastructure (4/4)

- [x] **INFRA-01**: AWS IAM credentials (access key + secret key) configured via environment variables
- [x] **INFRA-02**: AWS region configured for latency-optimized Bedrock inference
- [x] **INFRA-03**: Old provider SDK dependencies removed (openai, @deepgram/sdk)
- [x] **INFRA-04**: Old provider environment variables removed (OPENAI_API_KEY, DEEPGRAM_API_KEY, ELEVENLABS_API_KEY)

### Audio (3/3)

- [x] **AUDIO-01**: mulaw 8kHz → PCM conversion for STT input from Twilio
- [x] **AUDIO-02**: PCM → mulaw 8kHz conversion for TTS output to Twilio
- [x] **AUDIO-03**: Audio conversion works with concurrent calls without blocking

### STT (4/4)

- [x] **STT-01**: Real-time streaming transcription via AWS Transcribe Streaming
- [x] **STT-02**: Utterance/endpoint detection triggers transcript events
- [x] **STT-03**: EventEmitter interface preserved (transcript, utterance_end, error, close events)
- [x] **STT-04**: Handles connection lifecycle (connect, send audio, close)

### TTS (4/4)

- [x] **TTS-01**: Text-to-speech audio generation via Amazon Polly
- [x] **TTS-02**: Streaming audio chunks emitted via EventEmitter (audio, done, error events)
- [x] **TTS-03**: Interruption/abort support for barge-in
- [x] **TTS-04**: Neural voice selected for natural conversation quality

### LLM (5/5)

- [x] **LLM-01**: Multi-turn conversation via AWS Bedrock Converse API with Claude model
- [x] **LLM-02**: Tool calling ported: book_appointment, check_availability, collect_customer_info, get_business_info
- [x] **LLM-03**: System prompt and business profile context passed to Claude
- [x] **LLM-04**: Streaming responses for lower time-to-first-token
- [x] **LLM-05**: Tool execution loop handles multi-step tool calls

### Integration (3/3)

- [x] **INTG-01**: End-to-end inbound call works: ring → greeting → conversation → booking → hangup
- [x] **INTG-02**: Barge-in/interruption works at all conversation stages
- [x] **INTG-03**: Call manager orchestration unchanged (same ActiveCall interface)

## Traceability

| Requirement | Phase | Evidence |
|-------------|-------|----------|
| INFRA-01 | Phase 1 | `env.ts` loads AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY |
| INFRA-02 | Phase 1 | Default us-east-2, overridable via AWS_REGION |
| INFRA-03 | Phase 6 | openai, @deepgram/sdk removed from package.json |
| INFRA-04 | Phase 6 | Startup validation errors if legacy vars set |
| AUDIO-01 | Phase 2 | `mulawToPcm()` in audio-convert.ts |
| AUDIO-02 | Phase 2 | `pcmToMulaw()` in audio-convert.ts |
| AUDIO-03 | Phase 2 | Synchronous buffer ops, perf test validates <1s for 10s audio |
| STT-01 | Phase 3 | AWSTranscribeSTT uses TranscribeStreamingClient |
| STT-02 | Phase 3 | 300ms debounce triggers utterance_end event |
| STT-03 | Phase 3 | Emits transcript, utterance_end, error, close |
| STT-04 | Phase 3 | start(), sendAudio(), stop() implemented |
| TTS-01 | Phase 4 | AWSPollyTTS uses SynthesizeSpeechCommand |
| TTS-02 | Phase 4 | 100ms chunks emitted via EventEmitter |
| TTS-03 | Phase 4 | AbortController, interrupt() method |
| TTS-04 | Phase 4 | Uses generative engine with Ruth voice |
| LLM-01 | Phase 5 | ConversationState.messages accumulates turns |
| LLM-02 | Phase 5 | All 4 tools in bedrockTools array |
| LLM-03 | Phase 5 | buildSystemPrompt() with business profile |
| LLM-04 | Phase 5 | ConverseStreamCommand with sentence detection |
| LLM-05 | Phase 5 | Tool loop with maxAttempts=5 |
| INTG-01 | Phase 6 | Integration tests verify 4 call scenarios |
| INTG-02 | Phase 6 | TTS.interrupt() called on caller speech |
| INTG-03 | Phase 6 | ActiveCall interface preserved |

## Deferred to v2

- **PERF-01**: Latency optimization with Bedrock prompt caching
- **PERF-02**: Audio conversion offloaded to worker threads for high concurrency
- **FALL-01**: Fallback provider support if AWS services fail

## Out of Scope (Not Implemented)

| Feature | Reason |
|---------|--------|
| Multi-provider fallback chains | Simplifying to AWS-only stack per user decision |
| Business logic changes | Port tools as-is, no functional changes |
| Twilio telephony changes | Stays on Twilio, not migrating to AWS Connect |
| Database schema changes | No persistence changes needed |
| Admin dashboard changes | No UI changes for this migration |
| OAuth/SSO for AWS auth | IAM credentials sufficient for this milestone |

---
*Archived: 2026-01-30*
